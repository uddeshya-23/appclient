(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{213:function(e,t,n){},223:function(e,t,n){"use strict";n.r(t);var a=n(80),s=n.n(a);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var r=n(0),c=n(39),o=n(17),i=n(243),l=(n(212),n(213),n(16)),j=n(40),d=n(180),b=n(3),u={user:null};if(localStorage.getItem("jwtToken")){var m=Object(d.a)(localStorage.getItem("jwtToken"));1e3*m.exp<Date.now()?localStorage.removeItem("jwtToken"):u.user=m}var O=Object(r.createContext)({user:null,login:function(e){},logout:function(){}});function h(e,t){switch(t.type){case"LOGIN":return Object(j.a)(Object(j.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(j.a)(Object(j.a)({},e),{},{user:null});default:return e}}function p(e){var t=Object(r.useReducer)(h,u),n=Object(l.a)(t,2),a=n[0],s=n[1];return Object(b.jsx)(O.Provider,Object(j.a)({value:{user:a.user,login:function(e){localStorage.setItem("jwtToken",e.token),s({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),s({type:"LOGOUT"})}}},e))}var x=n(196),g=["component"];var v=function(e){var t=e.component,n=Object(x.a)(e,g),a=Object(r.useContext)(O).user;return Object(b.jsx)(o.b,Object(j.a)(Object(j.a)({},n),{},{render:function(e){return a?Object(b.jsx)(o.a,{to:"/"}):Object(b.jsx)(t,Object(j.a)({},e))}}))},f=n(248);var C=function(){var e=Object(r.useContext)(O),t=e.user,n=e.logout,a=window.location.pathname,s="/"===a?"home":a.substr(1),o=Object(r.useState)(s),i=Object(l.a)(o,2),j=i[0],d=i[1],u=function(e,t){var n=t.name;return d(n)};return t?Object(b.jsxs)(f.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(b.jsx)(f.a.Item,{name:t.username,active:!0,as:c.b,to:"/"}),Object(b.jsx)(f.a.Menu,{position:"right",children:Object(b.jsx)(f.a.Item,{name:"logout",onClick:n})})]}):Object(b.jsxs)(f.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(b.jsx)(f.a.Item,{name:"home",active:"home"===j,onClick:u,as:c.b,to:"/"}),Object(b.jsxs)(f.a.Menu,{position:"right",children:[Object(b.jsx)(f.a.Item,{name:"login",active:"login"===j,onClick:u,as:c.b,to:"/login"}),Object(b.jsx)(f.a.Item,{name:"register",active:"register"===j,onClick:u,as:c.b,to:"/register"})]})]})},y=n(253),w=n(255),I=n(249),k=n(251),P=n(192),S=n(252),$=n(109),N=n(146),A=n(116),D=n.n(A),L=n(30),E=n(246),R=n(31),T=n(245);var Q,U=function(e){var t=e.content,n=e.children;return Object(b.jsx)(T.a,{inverted:!0,content:t,trigger:n})};var q,z,B,G=Object(R.a)(Q||(Q=Object(L.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      id\n      likes {\n        id\n        username\n      }\n      likeCount\n    }\n  }\n"]))),M=function(e){var t=e.user,n=e.post,a=n.id,s=n.likeCount,o=n.likes,i=Object(r.useState)(!1),j=Object(l.a)(i,2),d=j[0],u=j[1];Object(r.useEffect)((function(){t&&o.find((function(e){return e.username===t.username}))?u(!0):u(!1)}),[t,o]);var m=Object(E.a)(G,{variables:{postId:a}}),O=Object(l.a)(m,1)[0],h=t?d?Object(b.jsx)(S.a,{color:"teal",children:Object(b.jsx)($.a,{name:"heart"})}):Object(b.jsx)(S.a,{color:"teal",basic:!0,children:Object(b.jsx)($.a,{name:"heart"})}):Object(b.jsx)(S.a,{as:c.b,to:"/login",color:"teal",basic:!0,children:Object(b.jsx)($.a,{name:"heart"})});return Object(b.jsxs)(S.a,{as:"div",labelPosition:"right",onClick:O,children:[Object(b.jsx)(U,{content:d?"Unlike":"Like",children:h}),Object(b.jsx)(N.a,{basic:!0,color:"teal",pointing:"left",children:s})]})},H=n(250),F=Object(R.a)(q||(q=Object(L.a)(["\n  {\n    getPosts {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"])));var W=Object(R.a)(z||(z=Object(L.a)(["\n  mutation deletePost($postId: ID!) {\n    deletePost(postId: $postId)\n  }\n"]))),J=Object(R.a)(B||(B=Object(L.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!) {\n    deleteComment(postId: $postId, commentId: $commentId) {\n      id\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n      commentCount\n    }\n  }\n"]))),V=function(e){var t=e.postId,n=e.commentId,a=e.callback,s=Object(r.useState)(!1),c=Object(l.a)(s,2),o=c[0],i=c[1],j=n?J:W,d=Object(E.a)(j,{update:function(e){if(i(!1),!n){var s=e.readQuery({query:F});s.getPosts=s.getPosts.filter((function(e){return e.id!==t})),e.writeQuery({query:F,data:s})}a&&a()},variables:{postId:t,commentId:n}}),u=Object(l.a)(d,1)[0];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(U,{content:n?"Delete comment":"Delete post",children:Object(b.jsx)(S.a,{as:"div",color:"red",floated:"right",onClick:function(){return i(!0)},children:Object(b.jsx)($.a,{name:"trash",style:{margin:0}})})}),Object(b.jsx)(H.a,{open:o,onCancel:function(){return i(!1)},onConfirm:u})]})};var K,X=function(e){var t=e.post,n=t.body,a=t.createdAt,s=t.id,o=t.username,i=t.likeCount,l=t.commentCount,j=t.likes,d=Object(r.useContext)(O).user;return Object(b.jsxs)(k.a,{fluid:!0,children:[Object(b.jsxs)(k.a.Content,{children:[Object(b.jsx)(P.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(b.jsx)(k.a.Header,{children:o}),Object(b.jsx)(k.a.Meta,{as:c.b,to:"/posts/".concat(s),children:D()(a).fromNow(!0)}),Object(b.jsx)(k.a.Description,{children:n})]}),Object(b.jsxs)(k.a.Content,{extra:!0,children:[Object(b.jsx)(M,{user:d,post:{id:s,likes:j,likeCount:i}}),Object(b.jsx)(U,{content:"Comment on post",children:Object(b.jsxs)(S.a,{labelPosition:"right",as:c.b,to:"/posts/".concat(s),children:[Object(b.jsx)(S.a,{color:"blue",basic:!0,children:Object(b.jsx)($.a,{name:"comments"})}),Object(b.jsx)(N.a,{basic:!0,color:"blue",pointing:"left",children:l})]})}),d&&d.username===o&&Object(b.jsx)(V,{postId:s})]})]})},Y=n(194),Z=n(247),_=n(122),ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.useState)(t),a=Object(l.a)(n,2),s=a[0],c=a[1],o=function(e){c(Object(j.a)(Object(j.a)({},s),{},Object(_.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:o,onSubmit:i,values:s}};var te=Object(R.a)(K||(K=Object(L.a)(["\n  mutation createPost($body: String!) {\n    createPost(body: $body) {\n      id\n      body\n      createdAt\n      username\n      likes {\n        id\n        username\n        createdAt\n      }\n      likeCount\n      comments {\n        id\n        body\n        username\n        createdAt\n      }\n      commentCount\n    }\n  }\n"]))),ne=function(){var e=ee((function(){c()}),{body:""}),t=e.values,n=e.onChange,a=e.onSubmit,s=Object(E.a)(te,{variables:t,update:function(e,n){var a=e.readQuery({query:F});a.getPosts=[n.data.createPost].concat(Object(Y.a)(a.getPosts)),e.writeQuery({query:F,data:a}),t.body=""}}),r=Object(l.a)(s,2),c=r[0],o=r[1].error;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)(Z.a,{onSubmit:a,children:[Object(b.jsx)("h2",{children:"Create a post:"}),Object(b.jsxs)(Z.a.Field,{children:[Object(b.jsx)(Z.a.Input,{placeholder:"Hi World!",name:"body",onChange:n,value:t.body,error:!!o}),Object(b.jsx)(S.a,{type:"submit",color:"teal",children:"Submit"})]})]}),o&&Object(b.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(b.jsx)("ul",{className:"list",children:Object(b.jsx)("li",{children:o.graphQLErrors[0].message})})})]})};var ae,se=function(){var e=Object(r.useContext)(O).user,t=Object(y.a)(F),n=t.loading,a=t.data,s=(a=void 0===a?{}:a).getPosts;return Object(b.jsxs)(w.a,{columns:3,children:[Object(b.jsx)(w.a.Row,{className:"page-title",children:Object(b.jsx)("h1",{children:"Recent Posts"})}),Object(b.jsxs)(w.a.Row,{children:[e&&Object(b.jsx)(w.a.Column,{children:Object(b.jsx)(ne,{})}),n?Object(b.jsx)("h1",{children:"Loading posts.."}):Object(b.jsx)(I.a.Group,{children:s&&s.map((function(e){return Object(b.jsx)(w.a.Column,{style:{marginBottom:20},children:Object(b.jsx)(X,{post:e})},e.id)}))})]})]})};var re,ce=Object(R.a)(ae||(ae=Object(L.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),oe=function(e){var t=Object(r.useContext)(O),n=Object(r.useState)({}),a=Object(l.a)(n,2),s=a[0],c=a[1],o=ee((function(){h()}),{username:"",password:""}),i=o.onChange,j=o.onSubmit,d=o.values,u=Object(E.a)(ce,{update:function(n,a){var s=a.data.login;t.login(s),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),m=Object(l.a)(u,2),h=m[0],p=m[1].loading;return Object(b.jsxs)("div",{className:"form-container",children:[Object(b.jsxs)(Z.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(b.jsx)("h1",{children:"Login"}),Object(b.jsx)(Z.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:d.username,error:!!s.username,onChange:i}),Object(b.jsx)(Z.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:d.password,error:!!s.password,onChange:i}),Object(b.jsx)(S.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(s).length>0&&Object(b.jsx)("div",{className:"ui error message",children:Object(b.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(b.jsx)("li",{children:e},e)}))})})]})};var ie,le,je=Object(R.a)(re||(re=Object(L.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      id\n      email\n      username\n      createdAt\n      token\n    }\n  }\n"]))),de=function(e){var t=Object(r.useContext)(O),n=Object(r.useState)({}),a=Object(l.a)(n,2),s=a[0],c=a[1],o=ee((function(){h()}),{username:"",email:"",password:"",confirmPassword:""}),i=o.onChange,j=o.onSubmit,d=o.values,u=Object(E.a)(je,{update:function(n,a){var s=a.data.register;t.login(s),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),m=Object(l.a)(u,2),h=m[0],p=m[1].loading;return Object(b.jsxs)("div",{className:"form-container",children:[Object(b.jsxs)(Z.a,{onSubmit:j,noValidate:!0,className:p?"loading":"",children:[Object(b.jsx)("h1",{children:"Register"}),Object(b.jsx)(Z.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",value:d.username,error:!!s.username,onChange:i}),Object(b.jsx)(Z.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"email",value:d.email,error:!!s.email,onChange:i}),Object(b.jsx)(Z.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"password",value:d.password,error:!!s.password,onChange:i}),Object(b.jsx)(Z.a.Input,{label:"Confirm Password",placeholder:"Confirm Password..",name:"confirmPassword",type:"password",value:d.confirmPassword,error:!!s.confirmPassword,onChange:i}),Object(b.jsx)(S.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(s).length>0&&Object(b.jsx)("div",{className:"ui error message",children:Object(b.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(b.jsx)("li",{children:e},e)}))})})]})};var be=Object(R.a)(ie||(ie=Object(L.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body) {\n      id\n      comments {\n        id\n        body\n        createdAt\n        username\n      }\n      commentCount\n    }\n  }\n"]))),ue=Object(R.a)(le||(le=Object(L.a)(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"]))),me=function(e){var t,n=e.match.params.postId,a=Object(r.useContext)(O).user,s=Object(r.useRef)(null),c=Object(r.useState)(""),o=Object(l.a)(c,2),i=o[0],j=o[1],d=Object(y.a)(ue,{variables:{postId:n}}).data,u=(d=void 0===d?{}:d).getPost,m=Object(E.a)(be,{update:function(){j(""),s.current.blur()},variables:{postId:n,body:i}}),h=Object(l.a)(m,1)[0];if(u){var p=u.id,x=u.body,g=u.createdAt,v=u.username,f=u.comments,C=u.likes,I=u.likeCount,A=u.commentCount;t=Object(b.jsx)(w.a,{children:Object(b.jsxs)(w.a.Row,{children:[Object(b.jsx)(w.a.Column,{width:2,children:Object(b.jsx)(P.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})}),Object(b.jsxs)(w.a.Column,{width:10,children:[Object(b.jsxs)(k.a,{fluid:!0,children:[Object(b.jsxs)(k.a.Content,{children:[Object(b.jsx)(k.a.Header,{children:v}),Object(b.jsx)(k.a.Meta,{children:D()(g).fromNow()}),Object(b.jsx)(k.a.Description,{children:x})]}),Object(b.jsx)("hr",{}),Object(b.jsxs)(k.a.Content,{extra:!0,children:[Object(b.jsx)(M,{user:a,post:{id:p,likeCount:I,likes:C}}),Object(b.jsx)(U,{content:"Comment on post",children:Object(b.jsxs)(S.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("Comment on post")},children:[Object(b.jsx)(S.a,{basic:!0,color:"blue",children:Object(b.jsx)($.a,{name:"comments"})}),Object(b.jsx)(N.a,{basic:!0,color:"blue",pointing:"left",children:A})]})}),a&&a.username===v&&Object(b.jsx)(V,{postId:p,callback:function(){e.history.push("/")}})]})]}),a&&Object(b.jsx)(k.a,{fluid:!0,children:Object(b.jsxs)(k.a.Content,{children:[Object(b.jsx)("p",{children:"Post a comment"}),Object(b.jsx)(Z.a,{children:Object(b.jsxs)("div",{className:"ui action input fluid",children:[Object(b.jsx)("input",{type:"text",placeholder:"Comment..",name:"comment",value:i,onChange:function(e){return j(e.target.value)},ref:s}),Object(b.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===i.trim(),onClick:h,children:"Submit"})]})})]})}),f.map((function(e){return Object(b.jsx)(k.a,{fluid:!0,children:Object(b.jsxs)(k.a.Content,{children:[a&&a.username===e.username&&Object(b.jsx)(V,{postId:p,commentId:e.id}),Object(b.jsx)(k.a.Header,{children:e.username}),Object(b.jsx)(k.a.Meta,{children:D()(e.createdAt).fromNow()}),Object(b.jsx)(k.a.Description,{children:e.body})]})},e.id)}))]})]})})}else t=Object(b.jsx)("p",{children:"Loading post.."});return t};var Oe=function(){return Object(b.jsx)(p,{children:Object(b.jsx)(c.a,{children:Object(b.jsxs)(i.a,{children:[Object(b.jsx)(C,{}),Object(b.jsx)(o.b,{exact:!0,path:"/",component:se}),Object(b.jsx)(v,{exact:!0,path:"/login",component:oe}),Object(b.jsx)(v,{exact:!0,path:"/register",component:de}),Object(b.jsx)(o.b,{exact:!0,path:"/posts/:postId",component:me})]})})})},he=n(189),pe=n(193),xe=n(195),ge=n(244),ve=n(188),fe=Object(xe.a)({uri:"http://localhost:5000"}),Ce=Object(ve.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),ye=new he.a({link:Ce.concat(fe),cache:new pe.a}),we=Object(b.jsx)(ge.a,{client:ye,children:Object(b.jsx)(Oe,{})});s.a.render(we,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[223,1,2]]]);
//# sourceMappingURL=main.9327818f.chunk.js.map